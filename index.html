<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>自転車安全運転支援アプリ UI</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="style.css" />
    <script src="./script/app.js" defer></script>
    <script src="./script/viewPost/index.js" defer></script>
  </head>
  <body>
    <div class="device-frame">
      <!-- ========== 全ページ共通のヘッダー ========== -->
      <header class="app-header">
        <div class="header-with-back">
          <!-- 戻るボタン（メニュー画面では非表示） -->
          <button
            type="button"
            class="back-button"
            id="globalBackBtn"
            style="display: none"
          >
            <i class="fa-solid fa-chevron-left"></i>
          </button>
          <!-- ページのタイトル（画面切り替え時に動的に変更） -->
          <span id="globalTitle">自転車安全運転支援アプリ</span>
        </div>
        <!-- ユーザーアイコン -->
        <i class="fa-solid fa-circle-user user-icon"></i>
      </header>

      <!-- ========== 画面1: ホーム（メニュー） ========== -->
      <div
        class="mobile-screen screen active"
        id="menuScreen"
        data-title="自転車安全運転支援アプリ"
      >
        <main>
          <div class="grid-menu">
            <!-- ボタンをクリックすると data-screen で指定された画面に切り替わる -->
            <button
              class="menu-card"
              data-screen="mapScreen"
              data-callback="setMapView"
              type="button"
            >
              <i class="fa-solid fa-map"></i>
              <span>経路案内</span>
            </button>
            <button class="menu-card" data-screen="quizScreen" type="button">
              <i class="fa-solid fa-circle-question"></i>
              <span>交通ルール<br />クイズ</span>
            </button>
            <button class="menu-card" type="button" data-screen="viewScreen">
              <i class="fa-solid fa-comments"></i>
              <span>掲示板</span>
            </button>
            <button
              class="menu-card"
              type="button"
              data-screen="feedbackScreen"
            >
              <i class="fa-solid fa-chart-simple"></i>
              <span>傾向フィード<br />バック</span>
            </button>
          </div>
        </main>
      </div>

      <!-- 画面2: マップ表示画面 -->
      <div class="mobile-screen screen" id="mapScreen" data-title="経路マップ">
        <main>
          <div class="map-screen-main">
            <div class="map-controls">
              <button
                class="map-control-btn active"
                id="mapViewAlertBtn"
                data-view="alert"
              >
                危険アラート
              </button>
              <button
                class="map-control-btn"
                id="mapViewNormalBtn"
                data-view="normal"
              >
                マップ表示
              </button>
            </div>

            <div class="map-large" id="mapAlertView">
              <div class="alert-banner">危険アラート</div>
              <div
                class="map-placeholder"
                style="
                  height: calc(100% - 48px);
                  background-image: url('https://placehold.co/360x420/ffefef/f0703a?text=Alert+Map');
                "
              ></div>
            </div>

            <div class="map-large" id="mapNormalView" style="display: none">
              <div
                class="map-placeholder"
                style="
                  background-image: url('https://placehold.co/360x520/e6f4ff/2d70b3?text=Map+Display');
                "
              ></div>
              <div class="map-overlay-label">マップ表示</div>
            </div>
          </div>
        </main>
      </div>

      <!-- 画面3: クイズ選択画面 -->
      <div
        class="mobile-screen screen"
        id="quizScreen"
        data-title="交通ルールクイズ"
      >
        <main>
          <div class="quiz-list">
            <button type="button" class="quiz-selection-card" data-screen="quizQuestionScreen" data-quiz-type="signal">
              <h3>🚦 信号のルール</h3>
              <p>信号機の正しい理解と従い方を学習する。</p>
              <span class="quiz-difficulty difficulty-easy">初級</span>
            </button>
            <button type="button" class="quiz-selection-card">
              <h3>🛑 一時停止と安全確認</h3>
              <p>交差点での安全確認と一時停止について。</p>
              <span class="quiz-difficulty difficulty-medium">中級</span>
            </button>
            <button type="button" class="quiz-selection-card">
              <h3>👥 歩行者優先の原則</h3>
              <p>自転車と歩行者の関係性と優先順位について。</p>
              <span class="quiz-difficulty difficulty-medium">中級</span>
            </button>
            <button type="button" class="quiz-selection-card">
              <h3>🚗 自動車との共存</h3>
              <p>自転車が自動車の死角に入ることの危険性について。</p>
              <span class="quiz-difficulty difficulty-hard">上級</span>
            </button>
          </div>
        </main>
      </div>

      <!-- 画面3.5: クイズ出題画面 -->
      <div
        class="mobile-screen screen"
        id="quizQuestionScreen"
        data-title="信号のルール"
      >
        <main>
          <div class="quiz-question-container">
            <div class="quiz-progress">
              <div class="progress-bar">
                <div class="progress-fill" style="width: 0%"></div>
              </div>
              <span class="progress-text">問題0/0</span>
            </div>

            <div class="question-area">
              <div class="question-text">
                <p>問題が読み込まれています...</p>
              </div>
              <div class="question-image">
                <img src="https://placehold.co/300x150/e6f4ff/2d70b3?text=Traffic+Light" alt="問題画像" />
              </div>
              <div class="answer-options">
                <!-- 選択肢は動的に挿入されます -->
              </div>
              <div class="explanation" aria-live="polite" style="display:none">
                <h4 class="explanation-title">解説</h4>
                <p class="explanation-text"></p>
              </div>
              <div class="quiz-controls">
                <button id="quizNextBtn" class="btn-submit" type="button" disabled>次へ</button>
              </div>
            </div>
          </div>
        </main>
      </div>

      <!-- 画面4: 傾向フィードバック画面 -->
      <div
        class="mobile-screen screen"
        id="feedbackScreen"
        data-title="傾向フィードバック"
      >
        <main>
          <div class="feedback-container">
            <!-- スコアカード -->
            <div class="score-card">
              <div class="score-label">現在の運転スコア: 85点</div>
              <div class="score-rating">評価: 良好</div>
            </div>

            <!-- 違反傾向グラフ -->
            <div class="violation-section">
              <h3>違反傾向グラフ</h3>
              <div class="chart-container">
                <div class="pie-chart">
                  <div class="chart-text text-red">60%</div>
                  <div class="chart-text text-yellow">20%</div>
                  <div class="chart-text text-green">20%</div>
                </div>
              </div>
              <div class="chart-legend">
                <div class="legend-item" data-color="#e74c3c">
                  <span class="legend-dot"></span>
                  <span>一時停止無視 (3回) - 要注意</span>
                </div>
                <div class="legend-item" data-color="#f39c12">
                  <span class="legend-dot"></span>
                  <span>速度超過 (1回) - 改善</span>
                </div>
                <div class="legend-item" data-color="#27ae60">
                  <span class="legend-dot"></span>
                  <span>並進 (1回) - 改善</span>
                </div>
              </div>
            </div>

            <!-- 総合評価 -->
            <div class="overall-rating">
              <h3>総合評価</h3>
              <p class="rating-text">
                全体的に安全運転ですが、一時停止に注意しましょう。
              </p>
              <div class="score-trend">
                <h4>過去のスコア推移</h4>
                <svg viewBox="0 0 300 120" class="line-chart" role="img" aria-labelledby="score-trend-title">
                  <title id="score-trend-title">過去のスコア推移グラフ</title>
                  <!-- グリッドライン -->
                  <line
                    x1="30"
                    y1="100"
                    x2="290"
                    y2="100"
                    stroke="#ddd"
                    stroke-width="1"
                  />
                  <!-- ポイント -->
                  <circle cx="50" cy="70" r="3" fill="#2d70b3" />
                  <circle cx="110" cy="55" r="3" fill="#2d70b3" />
                  <circle cx="170" cy="40" r="3" fill="#2d70b3" />
                  <circle cx="230" cy="25" r="3" fill="#2d70b3" />
                  <!-- ラインで接続 -->
                  <polyline
                    points="50,70 110,55 170,40 230,25"
                    fill="none"
                    stroke="#2d70b3"
                    stroke-width="2"
                  />
                  <!-- ラベル -->
                  <text
                    x="50"
                    y="115"
                    font-size="12"
                    text-anchor="middle"
                    fill="#666"
                  >
                    70
                  </text>
                  <text
                    x="110"
                    y="115"
                    font-size="12"
                    text-anchor="middle"
                    fill="#666"
                  >
                    75
                  </text>
                  <text
                    x="170"
                    y="115"
                    font-size="12"
                    text-anchor="middle"
                    fill="#666"
                  >
                    80
                  </text>
                  <text
                    x="230"
                    y="115"
                    font-size="12"
                    text-anchor="middle"
                    fill="#666"
                  >
                    85
                  </text>
                </svg>
              </div>
            </div>
          </div>
        </main>
      </div>

      <!-- 画面5-1: 掲示板投稿画面 -->
      <div
        class="mobile-screen screen"
        id="postScreen"
        data-title="投稿タグを選択"
      >
        <main>
          <div class="form-group">
            <label class="form-label" for="select">投稿タグ</label>
            <select class="form-select" id="select">
              <option>投稿タグを選択</option>
              <option>事故・危険</option>
              <option>道路情報</option>
              <option>施設情報</option>
              <option>その他</option>
            </select>
          </div>

          <div class="form-group">
            <label class="form-label" for="text-title">タイトル</label>
            <input type="text" class="form-input" id="text-title" />
          </div>

          <div class="form-group">
            <label class="form-label" for="file-thumbnail">サムネイル</label>
            <div class="upload-area">
              <div class="btn-upload">
                <input type="file" accept="image/*" id="file-thumbnail" />
                <i class="fa-solid fa-upload"></i> アップロード
              </div>
              <div class="upload-placeholder">
                <i class="fa-regular fa-image"></i>
              </div>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label" for="textarea">テキスト本文</label>
            <textarea class="form-textarea" id="textarea"></textarea>
          </div>

          <button class="btn-submit" type="submit">送信ボタン</button>
        </main>
      </div>

      <!-- 画面5-2: 掲示板閲覧画面 -->
      <div
        class="mobile-screen screen"
        id="viewScreen"
        data-title="投稿一覧"
      >
        <main>
          <div style="padding-bottom:12px">
            <button class="menu-card" data-screen="postScreen" type="button" style="padding:10px 12px; display:inline-block; width:auto">投稿はこちら </button>
          </div>
          <div class="media" id="body">
            <img class="media__img" src="./img/index_img_01.png" alt="" width="1183" height="730">
            <details class="postItem">
              <summary class="postItem__pin --01">
                掲示板投稿の位置情報
              </summary>
              <div class="postItem__content">
                <span class="post-tag">事故・危険</span>
                <img class="post-thumbnail" src="https://placehold.co/360x520/" alt="サムネイル">
                <h3>投稿01</h3>
                <p>交差点付近で事故が起きました</p>
              </div>
            </details>
            <details class="postItem">
              <summary class="postItem__pin --02">
                掲示板投稿の位置情報
              </summary>
              <div class="postItem__content">
                <span class="post-tag">道路情報</span>
                <h3>投稿02</h3>
                <p>駅前の道路が混雑しています。注意が必要です。</p>
              </div>
            </details>
            <details class="postItem">
              <summary class="postItem__pin --03">
                掲示板投稿の位置情報
              </summary>
              <div class="postItem__content">
                <span class="post-tag">その他</span>
                <h3>投稿03</h3>
                <p>付近で工事が行われています。</p>
              </div>
            </details>
            <small>出典：地理院地図Vector</small>
          </div>
        </main>
      </div>

      <!-- 共通フッター -->
      <footer class="app-footer">
        <div class="nav-item"><i class="fa-solid fa-house"></i></div>
        <div class="nav-item active"><i class="fa-solid fa-bars"></i></div>
        <div class="nav-item"><i class="fa-regular fa-circle-user"></i></div>
      </footer>
    </div>
  </body>
</html>
